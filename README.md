# Conversational Agents with Discovery Engine Management Scripts

This directory contains a set of shell scripts for managing Conversational Agent agents and Discovery Engine data stores, along with Terraform configuration for infrastructure management.

## Prerequisites

Before using these scripts, ensure you have the following tools installed and configured:

- [Google Cloud SDK (gcloud)](https://cloud.google.com/sdk/docs/install)
- [curl](https://curl.se/download.html)
- [jq](https://stedolan.github.io/jq/download/)

You must also be authenticated with Google Cloud. Run `gcloud auth login` and `gcloud auth application-default login` if you have not done so already.

## Scripts

### `exportCA.sh`

Exports a Conversational Agent agent to a Google Cloud Storage (GCS) bucket. The script initiates the export and polls the operation until it is complete, then prints the final status.

**Usage:**
```bash
./exportCA.sh [OPTIONS]
```

**Options:**
- `-p, --project-id`: GCP Project ID.
- `-a, --agent-id`: Conversational Agent Agent ID.
- `-l, --location`: The agent's location (e.g., `global`, `us-central1`).
- `-b, --bucket-name`: GCS bucket name for the export.
- `-o, --object-name`: GCS object name for the exported agent.
- `-h, --help`: Display the help message.

### `restoreCA.sh`

Restores a Conversational Agent agent from a GCS bucket. The script initiates the restore and polls the operation until it is complete, then prints the final status.

**Usage:**
```bash
./restoreCA.sh [OPTIONS]
```

**Options:**
- `-p, --project-id`: GCP Project ID.
- `-a, --agent-id`: Conversational Agent Agent ID to restore to.
- `-l, --location`: The agent's location (e.g., `global`, `us-central1`).
- `-b, --bucket-name`: GCS bucket name where the agent is stored.
- `-o, --object-name`: GCS object name of the agent to restore.
- `-h, --help`: Display the help message.

### `import_documents.sh`

Imports documents into a Discovery Engine data store from a GCS bucket. The script initiates the import and polls the operation until it is complete, then prints the final status.

**Usage:**
```bash
./import_documents.sh [OPTIONS]
```

**Options:**
- `-p, --project-id`: GCP Project ID.
- `-l, --location`: Discovery Engine location (e.g., `us`, `global`).
- `-c, --collection-id`: Collection ID.
- `-d, --datastore-id`: Datastore ID.
- `-b, --branch-id`: Branch ID.
- `-g, --gcs-bucket`: GCS bucket name for the import source.
- `-h, --help`: Display the help message.

## Terraform Configuration

This directory also contains Terraform files for managing Google Cloud resources.

- `main.tf`: The main Terraform configuration file that defines the infrastructure resources.
- `variables.tf`: Contains variable declarations used in `main.tf`.
- `terraform.tfvars`: Contains the variable definitions. (Note: This file should be populated with your specific values and should not be committed to version control if it contains sensitive information).
- `.terraform.lock.hcl`: The dependency lock file generated by Terraform.

To use the Terraform configuration, initialize the directory and then apply the changes:
```bash
terraform init
terraform apply
```
**References**
- https://cloud.google.com/dialogflow/cx/docs/reference/rest/v3/projects.locations.agents/export
- https://cloud.google.com/dialogflow/cx/docs/reference/rest/v3/projects.locations.agents/restore
- https://cloud.google.com/dialogflow/cx/docs/concept/agent#export
- https://github.com/GoogleCloudPlatform/dfcx-scrapi/tree/main/examples/dfcx_agent_cicd/cicd_code (use what you can)
- https://cloud.google.com/generative-ai-app-builder/docs/configure-serving-controls (adding serving controls e.g. filtering and boosting)
- https://cloud.google.com/dialogflow/cx/docs/concept/data-store/search-configure#filter-specifications-filter-specs (trying to figure this one out)